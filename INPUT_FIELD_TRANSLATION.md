# 输入框翻译功能

## 功能概述

输入框翻译功能允许用户在任何文本输入框中通过连续快速敲击三下空格键来触发翻译。这个功能特别适用于：

- 搜索框中的查询翻译
- 表单填写时的文本翻译
- 聊天输入框的消息翻译
- 任何需要快速翻译输入内容的场景

## 功能特点

### 🎯 智能触发
- **触发方式**：连续快速敲击 3 次空格键
- **超时机制**：800ms 内完成三次敲击才有效
- **防误触**：输入其他字符会重置计数

### 📝 支持的输入元素
- `<input type="text">`
- `<input type="search">`
- `<input>` (无type属性)
- `<textarea>`
- `<div contenteditable="true">`

### 🎨 用户体验
- **加载动画**：翻译过程中显示旋转加载图标
- **结果展示**：翻译结果以弹窗形式显示在输入框附近
- **操作选项**：复制翻译结果、替换原文、关闭弹窗
- **自动隐藏**：5秒后自动隐藏结果弹窗

### ⚡ 性能优化
- **防抖机制**：300ms 防抖延迟避免频繁触发
- **文本验证**：最小长度2字符，最大长度5000字符
- **内存管理**：自动清理事件监听器和DOM元素

## 使用方法

### 1. 启用功能

#### 方法一：通过扩展弹窗
1. 点击浏览器工具栏中的 Open Translate 图标
2. 在弹窗中找到 "Input field translation (3x space)" 选项
3. 勾选该选项启用功能

#### 方法二：通过设置页面
1. 右键点击 Open Translate 图标，选择 "选项"
2. 在高级设置部分找到 "Enable input field translation trigger"
3. 勾选该选项并保存设置

### 2. 使用翻译功能

1. **聚焦输入框**：点击任意支持的输入元素
2. **输入文本**：输入需要翻译的内容
3. **触发翻译**：快速连续敲击 3 次空格键（800ms内）
4. **查看结果**：翻译结果会显示在输入框附近的弹窗中
5. **选择操作**：
   - 点击 "复制" 将翻译结果复制到剪贴板
   - 点击 "替换" 用翻译结果替换输入框中的原文
   - 点击 "关闭" 或等待5秒自动关闭弹窗

## 配置选项

### 默认配置
```javascript
{
  spaceKeyCount: 3,           // 连续空格键次数
  spaceKeyTimeout: 800,       // 空格键超时时间（毫秒）
  debounceDelay: 300,         // 防抖延迟
  minTextLength: 2,           // 最小文本长度
  maxTextLength: 5000,        // 最大文本长度
  enableAnimation: true       // 是否启用翻译动画
}
```

### 自定义配置
目前配置选项是硬编码的，未来版本可能会提供用户自定义配置界面。

## 技术实现

### 核心组件

#### InputFieldListener 类
- **事件监听**：使用事件委托监听全局键盘和焦点事件
- **状态管理**：跟踪当前活动输入元素和空格键按下状态
- **翻译集成**：与现有的 TranslationService 集成

#### 关键方法
- `initialize()`: 初始化监听器并绑定翻译服务
- `enable()/disable()`: 启用/禁用监听功能
- `handleKeyDown()`: 处理键盘事件，检测空格键序列
- `triggerTranslation()`: 触发翻译并显示结果
- `showTranslationResult()`: 显示翻译结果弹窗

### 集成点

#### Content Script 集成
- 在 `content.js` 中初始化 `InputFieldListener`
- 通过消息传递与弹窗和设置页面通信
- 在页面清理时正确释放资源

#### 用户界面集成
- 弹窗界面添加快速开关
- 设置页面添加详细配置选项
- 状态同步和持久化存储

## 测试

### 测试页面
项目根目录下的 `test-input-field.html` 提供了完整的测试环境：

- 各种类型的输入元素
- 示例文本和使用说明
- 控制台日志用于调试

### 测试步骤
1. 在浏览器中打开 `test-input-field.html`
2. 确保扩展已安装并启用输入框翻译功能
3. 在各种输入框中测试翻译触发
4. 验证翻译结果的显示和操作功能

## 故障排除

### 常见问题

#### 功能不工作
- 检查扩展是否已安装并启用
- 确认输入框翻译功能已在设置中启用
- 验证 API 配置是否正确

#### 触发不灵敏
- 确保在800ms内完成3次空格键敲击
- 检查是否在支持的输入元素中操作
- 避免在敲击空格键之间输入其他字符

#### 翻译失败
- 检查网络连接
- 验证 API 密钥是否有效
- 确认文本长度在支持范围内（2-5000字符）

### 调试信息
在浏览器开发者工具的控制台中可以看到：
- 输入框焦点事件
- 空格键按下事件
- 翻译触发和结果信息
- 错误信息和警告

## 未来改进

### 计划功能
- [ ] 用户自定义触发键组合
- [ ] 可配置的超时时间和文本长度限制
- [ ] 支持更多输入元素类型
- [ ] 翻译历史记录
- [ ] 快捷键支持

### 性能优化
- [ ] 更智能的文本检测
- [ ] 缓存常用翻译结果
- [ ] 减少内存占用
- [ ] 优化动画性能

## 贡献

欢迎提交问题报告和功能建议。在提交之前，请：

1. 检查现有的问题列表
2. 提供详细的复现步骤
3. 包含浏览器和扩展版本信息
4. 如果可能，提供测试用例

## 许可证

此功能遵循项目的整体许可证条款。
