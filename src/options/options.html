<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Open Translate - Settings</title>
  <link rel="stylesheet" href="options.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="header-text">
          <h1>Open Translate Settings</h1>
          <p>Configure your translation preferences and API settings</p>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      <!-- API Configuration Section -->
      <section class="settings-section">
        <h2 class="section-title">API Configuration</h2>
        <div class="section-content">
          <div class="form-group">
            <label for="apiUrl" class="form-label">API Endpoint URL</label>
            <input type="url" id="apiUrl" class="form-input" placeholder="https://api.openai.com/v1/chat/completions">
            <small class="form-help">Enter the OpenAI-compatible API endpoint URL</small>
          </div>

          <div class="form-group">
            <label for="apiKey" class="form-label">API Key</label>
            <div class="input-group">
              <input type="password" id="apiKey" class="form-input" placeholder="Enter your API key">
              <button type="button" id="toggleApiKey" class="toggle-btn" title="Show/Hide API Key">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                </svg>
              </button>
            </div>
            <small class="form-help">Your API key will be stored securely in Chrome's sync storage</small>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="model" class="form-label">Model</label>
              <div class="model-selection">
                <select id="model" class="form-select">
                  <option value="">Loading models...</option>
                </select>
                <button type="button" id="refreshModels" class="refresh-btn" title="Refresh available models">
                  Refresh Models
                </button>
              </div>
              <small class="form-help">Select a model or use custom model below</small>
            </div>

            <div class="form-group">
              <label for="temperature" class="form-label">Temperature</label>
              <input type="range" id="temperature" class="form-range" min="0" max="1" step="0.1" value="0.3">
              <span id="temperatureValue" class="range-value">0.3</span>
            </div>
          </div>

          <div class="form-group">
            <label for="customModel" class="form-label">
              Custom Model Name
              <span class="priority-indicator" id="modelPriorityIndicator"></span>
            </label>
            <input type="text" id="customModel" class="form-input" placeholder="Enter custom model name (optional)">
            <small class="form-help" id="modelHelp">Leave empty to use the selected model above. Custom model name will override the selected model.</small>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="maxTokens" class="form-label">Max Tokens</label>
              <input type="number" id="maxTokens" class="form-input" min="1500" max="16000" value="8000">
            </div>

            <div class="form-group">
              <label for="timeout" class="form-label">Timeout (seconds)</label>
              <input type="number" id="timeout" class="form-input" min="5" max="120" value="30">
            </div>
          </div>

          <div class="form-group">
            <button type="button" id="testConnection" class="test-btn">
              Test Connection
            </button>
            <div id="testResult" class="test-result hidden"></div>
          </div>
        </div>
      </section>



      <!-- Advanced Settings Section -->
      <section class="settings-section">
        <h2 class="section-title">Advanced Settings</h2>
        <div class="section-content">
          <div class="form-group">
            <label class="form-label">
              <input type="checkbox" id="smartContentEnabled" class="form-checkbox">
              Enable intelligent content recognition
            </label>
            <small class="form-help">The Mozilla Readability algorithm is used to automatically identify the main content area of web pages, reducing the need for manual configuration. It is enabled by default. When disabled, the traditional element identification method will be used.</small>
          </div>

          <div class="form-group">
            <label class="form-label">
              <input type="checkbox" id="inputFieldListenerEnabled" class="form-checkbox">
              Enable input field translation trigger
            </label>
            <small class="form-help">When enabled, you can trigger translation by pressing a hotkey in any text input field. The translation result will be displayed in a popup near the input field.</small>
          </div>

          <div class="form-group">
            <label for="inputFieldTriggerKey" class="form-label">Input Field Trigger Key</label>
            <select id="inputFieldTriggerKey" class="form-select">
              <option value="F2">F2</option>
              <option value="F3">F3</option>
              <option value="F4">F4</option>
              <option value="F9">F9</option>
              <option value="F10">F10</option>
              <option value="F11">F11</option>
              <option value="F12">F12</option>
            </select>
            <small class="form-help">Select the key to trigger translation in input fields. F2 is recommended as it's rarely used by websites.</small>
          </div>

          <div class="form-group">
            <label class="form-label">Trigger Key Modifiers</label>
            <div style="display: flex; gap: 15px; margin-top: 5px;">
              <label class="form-label">
                <input type="checkbox" id="inputFieldCtrlKey" class="form-checkbox">
                Ctrl
              </label>
              <label class="form-label">
                <input type="checkbox" id="inputFieldAltKey" class="form-checkbox">
                Alt
              </label>
              <label class="form-label">
                <input type="checkbox" id="inputFieldShiftKey" class="form-checkbox">
                Shift
              </label>
            </div>
            <small class="form-help">Optional modifier keys to combine with the trigger key (e.g., Ctrl+F2).</small>
          </div>

          <div class="form-group">
            <label class="form-label">
              <input type="checkbox" id="autoDetectPageLanguage" class="form-checkbox">
              Auto-detect page language for input field translation
            </label>
            <small class="form-help">When enabled, the system will detect the webpage's language and translate input text to that language. For example, on a Chinese website, English input will be translated to Chinese.</small>
          </div>

          <div class="form-group">
            <label for="defaultTargetLanguage" class="form-label">Default Target Language</label>
            <select id="defaultTargetLanguage" class="form-select">
              <option value="en">English</option>
              <option value="zh-CN">Chinese (Simplified)</option>
              <option value="zh-TW">Chinese (Traditional)</option>
              <option value="ja">Japanese</option>
              <option value="ko">Korean</option>
              <option value="fr">French</option>
              <option value="de">German</option>
              <option value="es">Spanish</option>
              <option value="ru">Russian</option>
              <option value="pt">Portuguese</option>
              <option value="it">Italian</option>
              <option value="ar">Arabic</option>
            </select>
            <small class="form-help">Fallback language used when page language detection fails or when the input language matches the page language.</small>
          </div>

          <div class="form-group">
            <label for="excludeSelectors" class="form-label">Exclude Selectors</label>
            <textarea id="excludeSelectors" class="form-textarea" rows="12" placeholder="Loading exclude selectors..."></textarea>
            <small class="form-help">This shows all exclude selectors. Default exclusions are built-in and shown at the top. Add your custom selectors after the "# User Additional Selectors:" comment line.</small>
          </div>

          <div class="form-group">
            <label for="batchSize" class="form-label">Concurrent Translation Limit</label>
            <input type="number" id="batchSize" class="form-input" min="1" max="20" value="5">
            <small class="form-help">Number of paragraphs to translate concurrently (higher values = faster translation but more API usage)</small>
          </div>

          <div class="form-group">
            <label for="retryAttempts" class="form-label">Retry Attempts</label>
            <input type="number" id="retryAttempts" class="form-input" min="0" max="5" value="2">
            <small class="form-help">Number of retry attempts for failed translations</small>
          </div>

          <!-- Smart Batching Configuration -->
          <div class="form-section">
            <h3 class="form-section-title">Smart Batching Optimization</h3>

            <div class="form-group">
              <label class="form-label">
                <input type="checkbox" id="enableSmartBatching" class="form-checkbox">
                Enable Smart Batching
              </label>
              <small class="form-help">Use intelligent token-based batching to minimize API calls and maximize efficiency</small>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-actions">
        <button type="button" id="resetSettings" class="secondary-btn">Reset to Defaults</button>
        <div class="primary-actions">
          <button type="button" id="saveSettings" class="primary-btn">Save Settings</button>
        </div>
      </div>
      <div class="footer-info">
        <p>Open Translate v1.0.7 - A powerful web translation extension</p>
      </div>
    </footer>

    <!-- Status Messages -->
    <div id="statusMessage" class="status-message hidden">
      <div class="status-content">
        <span class="status-text"></span>
        <button class="status-close">&times;</button>
      </div>
    </div>
  </div>

  <script src="../shared/constants.js"></script>
  <script src="../shared/config.js"></script>
  <script src="../shared/utils.js"></script>
  <script src="../shared/errorHandler.js"></script>
  <script src="../core/translator.js"></script>
  <script src="options.js"></script>
</body>
</html>
